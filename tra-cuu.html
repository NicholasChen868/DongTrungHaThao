<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tra C·ª©u ƒê∆°n H√†ng ‚Äî ƒê√¥ng Tr√πng H·∫° Th·∫£o maldalladuyduc</title>
    <meta name="description"
        content="Tra c·ª©u tr·∫°ng th√°i ƒë∆°n h√†ng ƒê√¥ng Tr√πng H·∫° Th·∫£o maldalladuyduc ‚Äî Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i ƒë·ªÉ ki·ªÉm tra ngay." />
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçÑ</text></svg>" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700&display=swap"
        rel="stylesheet" />
    <style>
        *,
        *::before,
        *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg: #060606;
            --bg-card: #111111;
            --gold: #d4a853;
            --gold-light: #e8c97a;
            --text: #f5f0e8;
            --text-sec: #a09888;
            --text-muted: #665e52;
            --border: rgba(212, 168, 83, 0.15);
            --success: #4ade80;
            --error: #f87171;
            --info: #60a5fa;
        }

        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Top bar */
        .top-bar {
            width: 100%;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border);
        }

        .top-bar a {
            color: var(--text-sec);
            text-decoration: none;
            font-size: 14px;
        }

        .top-bar a:hover {
            color: var(--gold-light);
        }

        .top-bar .brand {
            font-weight: 700;
            color: var(--gold-light);
            font-size: 1rem;
        }

        /* Main */
        .track-container {
            max-width: 560px;
            width: 100%;
            margin: 0 auto;
            padding: 48px 20px;
            flex: 1;
        }

        .track-hero {
            text-align: center;
            margin-bottom: 36px;
        }

        .track-hero .icon {
            font-size: 3rem;
            margin-bottom: 12px;
        }

        .track-hero h1 {
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .track-hero p {
            color: var(--text-sec);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Search box */
        .search-box {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 28px;
            margin-bottom: 24px;
        }

        .search-box label {
            display: block;
            font-size: 13px;
            color: var(--text-sec);
            margin-bottom: 8px;
        }

        .search-row {
            display: flex;
            gap: 10px;
        }

        .search-input {
            flex: 1;
            padding: 14px 18px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            font-size: 15px;
            font-family: inherit;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--gold);
        }

        .search-input::placeholder {
            color: var(--text-muted);
        }

        .btn-search {
            padding: 14px 24px;
            background: var(--gold);
            color: #0a0a0a;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
            white-space: nowrap;
        }

        .btn-search:hover {
            background: var(--gold-light);
        }

        .btn-search:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Results */
        .results {
            display: none;
        }

        .results.active {
            display: block;
        }

        .results-header {
            font-size: 14px;
            color: var(--text-sec);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .results-count {
            color: var(--gold-light);
            font-weight: 600;
        }

        /* Order card */
        .order-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 24px;
            margin-bottom: 14px;
            transition: border-color 0.2s;
        }

        .order-card:hover {
            border-color: rgba(212, 168, 83, 0.3);
        }

        .order-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 14px;
        }

        .order-id {
            font-weight: 700;
            font-size: 1rem;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-warning {
            background: rgba(251, 191, 36, 0.12);
            color: #fbbf24;
        }

        .badge-info {
            background: rgba(96, 165, 250, 0.12);
            color: var(--info);
        }

        .badge-success {
            background: rgba(74, 222, 128, 0.12);
            color: var(--success);
        }

        .badge-danger {
            background: rgba(248, 113, 113, 0.12);
            color: var(--error);
        }

        .order-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .order-field {}

        .order-field .label {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 2px;
        }

        .order-field .value {
            font-size: 14px;
            font-weight: 500;
        }

        /* Timeline */
        .order-timeline {
            margin-top: 16px;
            padding-top: 14px;
            border-top: 1px solid rgba(255, 255, 255, 0.04);
        }

        .timeline-title {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 10px;
        }

        .timeline-steps {
            display: flex;
            gap: 0;
        }

        .t-step {
            flex: 1;
            text-align: center;
            position: relative;
        }

        .t-step::before {
            content: '';
            position: absolute;
            top: 12px;
            left: 0;
            right: 0;
            height: 2px;
            background: rgba(255, 255, 255, 0.06);
            z-index: 0;
        }

        .t-step:first-child::before {
            left: 50%;
        }

        .t-step:last-child::before {
            right: 50%;
        }

        .t-dot {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.06);
            border: 2px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 6px;
            font-size: 10px;
            position: relative;
            z-index: 1;
        }

        .t-step.done .t-dot {
            background: rgba(74, 222, 128, 0.15);
            border-color: var(--success);
        }

        .t-step.active .t-dot {
            background: rgba(212, 168, 83, 0.2);
            border-color: var(--gold);
            animation: pulse 1.5s infinite;
        }

        .t-step.cancelled .t-dot {
            background: rgba(248, 113, 113, 0.15);
            border-color: var(--error);
        }

        .t-label {
            font-size: 11px;
            color: var(--text-muted);
        }

        .t-step.done .t-label {
            color: var(--success);
        }

        .t-step.active .t-label {
            color: var(--gold-light);
            font-weight: 600;
        }

        @keyframes pulse {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(212, 168, 83, 0.3);
            }

            50% {
                box-shadow: 0 0 0 6px rgba(212, 168, 83, 0);
            }
        }

        /* Empty */
        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 14px;
        }

        .empty-state .icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: #1a1a1a;
            border: 1px solid var(--border);
            border-left: 3px solid var(--success);
            border-radius: 10px;
            padding: 14px 20px;
            font-size: 14px;
            z-index: 9999;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s, transform 0.3s;
            max-width: 360px;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.error {
            border-left-color: var(--error);
        }

        @media (max-width: 480px) {
            .search-row {
                flex-direction: column;
            }

            .order-details {
                grid-template-columns: 1fr;
            }

            .timeline-steps {
                gap: 2px;
            }

            .t-label {
                font-size: 10px;
            }
        }
    </style>
</head>

<body>
    <!-- TOP BAR -->
    <div class="top-bar">
        <a href="/">‚Üê Trang ch·ªß</a>
        <span class="brand">üì¶ Tra C·ª©u ƒê∆°n H√†ng</span>
        <a href="/thanh-vien.html">üíõ Th√†nh Vi√™n</a>
    </div>

    <div class="track-container">
        <!-- HERO -->
        <div class="track-hero">
            <div class="icon">üì¶</div>
            <h1>Tra C·ª©u ƒê∆°n H√†ng</h1>
            <p>Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i b·∫°n ƒë√£ d√πng khi ƒë·∫∑t h√†ng<br>ƒë·ªÉ ki·ªÉm tra tr·∫°ng th√°i ƒë∆°n h√†ng ngay l·∫≠p t·ª©c</p>
        </div>

        <!-- SEARCH -->
        <div class="search-box">
            <label>S·ªë ƒëi·ªán tho·∫°i ƒë·∫∑t h√†ng</label>
            <div class="search-row">
                <input class="search-input" type="tel" id="trackPhone" placeholder="VD: 0901234567" required />
                <button class="btn-search" id="trackBtn" onclick="trackOrders()">üîç Tra c·ª©u</button>
            </div>
        </div>

        <!-- RESULTS -->
        <div class="results" id="results">
            <div class="results-header">
                <span>T√¨m th·∫•y</span>
                <span class="results-count" id="resultCount">0</span>
                <span>ƒë∆°n h√†ng</span>
            </div>
            <div id="orderList"></div>
        </div>
    </div>

    <div class="toast" id="trackToast"></div>

    <script type="module">
        import { supabase } from './src/supabase.js';
        import './src/utils/tracker.js';

        function showToast(msg, isError = false) {
            const t = document.getElementById('trackToast');
            t.textContent = msg;
            t.className = `toast show ${isError ? 'error' : ''}`;
            setTimeout(() => t.classList.remove('show'), 3000);
        }

        const statusConfig = {
            pending: { label: '‚è≥ Ch·ªù duy·ªát', cls: 'badge-warning', step: 0 },
            confirmed: { label: '‚úÖ ƒê√£ duy·ªát', cls: 'badge-info', step: 1 },
            shipping: { label: 'üöö ƒêang giao', cls: 'badge-info', step: 2 },
            completed: { label: '‚úì Ho√†n th√†nh', cls: 'badge-success', step: 3 },
            cancelled: { label: '‚úó ƒê√£ h·ªßy', cls: 'badge-danger', step: -1 },
        };

        const steps = ['ƒê·∫∑t h√†ng', 'X√°c nh·∫≠n', 'Giao h√†ng', 'Ho√†n th√†nh'];

        function renderTimeline(status) {
            const cfg = statusConfig[status] || statusConfig.pending;
            if (cfg.step === -1) {
                return `<div class="order-timeline">
                    <div class="timeline-title">Tr·∫°ng th√°i</div>
                    <div style="text-align:center;color:var(--error);font-size:14px">ƒê∆°n h√†ng ƒë√£ b·ªã h·ªßy</div>
                </div>`;
            }
            return `<div class="order-timeline">
                <div class="timeline-title">Ti·∫øn tr√¨nh ƒë∆°n h√†ng</div>
                <div class="timeline-steps">
                    ${steps.map((s, i) => {
                const cls = i < cfg.step ? 'done' : i === cfg.step ? 'active' : '';
                const icon = i < cfg.step ? '‚úì' : i === cfg.step ? '‚óè' : '‚óã';
                return `<div class="t-step ${cls}">
                            <div class="t-dot">${icon}</div>
                            <div class="t-label">${s}</div>
                        </div>`;
            }).join('')}
                </div>
            </div>`;
        }

        window.trackOrders = async function () {
            const phone = document.getElementById('trackPhone').value.trim();
            if (!phone) { showToast('Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i', true); return; }

            const btn = document.getElementById('trackBtn');
            btn.disabled = true;
            btn.textContent = 'ƒêang t√¨m...';

            try {
                const { data: orders, error } = await supabase.from('orders')
                    .select('*')
                    .eq('phone', phone)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                const results = document.getElementById('results');
                const orderList = document.getElementById('orderList');
                const countEl = document.getElementById('resultCount');

                if (!orders?.length) {
                    results.classList.add('active');
                    countEl.textContent = '0';
                    orderList.innerHTML = `<div class="empty-state">
                        <div class="icon">üîç</div>
                        <p>Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng v·ªõi SƒêT <strong>${phone}</strong></p>
                        <p style="margin-top:8px;font-size:13px">Ki·ªÉm tra l·∫°i SƒêT ho·∫∑c <a href="/#contact" style="color:var(--gold)">ƒë·∫∑t h√†ng ngay</a></p>
                    </div>`;
                    return;
                }

                countEl.textContent = orders.length;
                results.classList.add('active');

                const fmtDate = (d) => new Date(d).toLocaleDateString('vi-VN', {
                    day: '2-digit', month: '2-digit', year: 'numeric',
                    hour: '2-digit', minute: '2-digit'
                });
                const fmtMoney = (v) => Number(v || 0).toLocaleString('vi-VN') + '‚Ç´';

                orderList.innerHTML = orders.map(o => {
                    const cfg = statusConfig[o.status] || statusConfig.pending;
                    return `<div class="order-card">
                        <div class="order-top">
                            <span class="order-id">ƒê∆°n #${o.id}</span>
                            <span class="badge ${cfg.cls}">${cfg.label}</span>
                        </div>
                        <div class="order-details">
                            <div class="order-field">
                                <div class="label">Kh√°ch h√†ng</div>
                                <div class="value">${o.customer_name}</div>
                            </div>
                            <div class="order-field">
                                <div class="label">S·ªë l∆∞·ª£ng</div>
                                <div class="value">${o.quantity || 1} h·ªôp</div>
                            </div>
                            <div class="order-field">
                                <div class="label">T·ªïng ti·ªÅn</div>
                                <div class="value">${fmtMoney(o.total_amount)}</div>
                            </div>
                            <div class="order-field">
                                <div class="label">Ng√†y ƒë·∫∑t</div>
                                <div class="value">${fmtDate(o.created_at)}</div>
                            </div>
                            ${o.address ? `<div class="order-field" style="grid-column: 1/-1">
                                <div class="label">ƒê·ªãa ch·ªâ</div>
                                <div class="value">${o.address}</div>
                            </div>` : ''}
                        </div>
                        ${renderTimeline(o.status)}
                    </div>`;
                }).join('');

                showToast(`T√¨m th·∫•y ${orders.length} ƒë∆°n h√†ng`);

            } catch (err) {
                showToast('L·ªói tra c·ª©u: ' + err.message, true);
            } finally {
                btn.disabled = false;
                btn.textContent = 'üîç Tra c·ª©u';
            }
        };

        // Enter key to search
        document.getElementById('trackPhone').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') window.trackOrders();
        });

        // Auto-fill from URL params
        const urlPhone = new URLSearchParams(location.search).get('phone');
        if (urlPhone) {
            document.getElementById('trackPhone').value = urlPhone;
            window.trackOrders();
        }
    </script>
</body>

</html>